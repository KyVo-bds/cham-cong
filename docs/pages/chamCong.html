<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ch·∫•m C√¥ng</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script defer src="../js/chamCong.js?v=20250816232923"></script>
  <script src="../js/dateUtils.js?v=20250816232923"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100">
  <div class="page-shell">
    <h2 class="text-xl font-bold">üìä Ch·∫•m C√¥ng</h2>

    <!-- Nh·∫≠p file v√† thao t√°c -->
    <div class="p-4">
      <div class="grid gap-6 md:grid-cols-4">

        <!-- C·ªòT 1 -->
        <div class="md:col-span-2 border rounded-lg p-4 space-y-4">

          <!-- H√†ng 1: File ch·∫•m c√¥ng -->
          <div class="grid items-center gap-3 grid-cols-[8rem,1fr,7rem] w-full">
            <label class="text-gray-700 font-medium whitespace-nowrap">File ch·∫•m c√¥ng</label>

            <!-- Pretty file input -->
            <label class="group flex items-center gap-3 w-full min-w-0 h-11 px-3 border rounded-lg bg-white
                  hover:border-blue-400 focus-within:ring-2 focus-within:ring-blue-400 cursor-pointer">
              <input id="fileChamCong" type="file" accept=".xlsx" class="sr-only" data-file-display="#nameChamCong" />
              <span
                class="inline-flex items-center justify-center w-9 h-9 rounded-md border bg-gray-50 group-hover:bg-gray-100">üìÑ</span>
              <span id="nameChamCong" class="truncate text-gray-600">Ch·ªçn t·ªáp .xlsx‚Ä¶</span>
            </label>

            <button id="btnLoadChamCong" class="h-11 w-[7rem] rounded-lg bg-blue-600 text-white font-medium hover:bg-blue-700
                   focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-400">
              Load
            </button>
          </div>

          <!-- H√†ng 2: File th√¥ng tin NV -->
          <div class="grid items-center gap-3 grid-cols-[8rem,1fr,7rem] w-full">
            <label class="text-gray-700 font-medium whitespace-nowrap">File th√¥ng tin NV</label>

            <!-- Pretty file input -->
            <label class="group flex items-center gap-3 w-full min-w-0 h-11 px-3 border rounded-lg bg-white
                  hover:border-teal-400 focus-within:ring-2 focus-within:ring-teal-400 cursor-pointer">
              <input id="fileThongTinNV" type="file" accept=".xlsx" class="sr-only" data-file-display="#nameThongTin" />
              <span
                class="inline-flex items-center justify-center w-9 h-9 rounded-md border bg-gray-50 group-hover:bg-gray-100">üìÑ</span>
              <span id="nameThongTin" class="truncate text-gray-600">Ch·ªçn t·ªáp .xlsx‚Ä¶</span>
            </label>

            <button id="btnCapNhatThongTinNV" class="h-11 w-[7rem] rounded-lg bg-teal-500 text-white font-medium hover:bg-teal-600
                   focus:outline-none focus-visible:ring-2 focus-visible:ring-teal-400">
              C·∫≠p nh·∫≠t
            </button>
          </div>
        </div>





        <!-- C·ªôt 2: Ki·ªÉm tra + Reset -->
        <div class="border rounded-lg p-4 space-y-3">
          <button id="btnValidateData" class="w-full h-11 rounded-lg bg-amber-500 text-white font-medium
                 hover:bg-amber-600 active:bg-amber-700
                 focus:outline-none focus-visible:ring-2 focus-visible:ring-amber-400 transition-colors">
            Ki·ªÉm tra d·ªØ li·ªáu
          </button>

          <button id="resetBtn" class="w-full h-11 rounded-lg bg-rose-500 text-white font-medium
                 hover:bg-rose-600 active:bg-rose-700
                 focus:outline-none focus-visible:ring-2 focus-visible:ring-rose-400
                 transition-colors flex items-center justify-center gap-2">
            <span>üóëÔ∏è</span><span>Reset d·ªØ li·ªáu</span>
          </button>
        </div>

        <!-- C·ªôt 3: Nh·∫≠p + Xu·∫•t JSON -->
        <div class="border rounded-lg p-4 space-y-3">
          <button onclick="exportChamCongJson()" class="w-full h-11 rounded-lg bg-slate-700 text-white font-medium
                 hover:bg-slate-800 active:bg-slate-900
                 focus:outline-none focus-visible:ring-2 focus-visible:ring-slate-400
                 transition-colors flex items-center justify-center gap-2">
            <span>üì§</span><span>Xu·∫•t d·ªØ li·ªáu (.json)</span>
          </button>

          <label class="w-full h-11 rounded-lg bg-slate-500 text-white font-medium
                        hover:bg-slate-600 active:bg-slate-700 cursor-pointer
                        focus-within:outline-none focus-within:ring-2 focus-within:ring-slate-400
                        transition-colors flex items-center justify-center gap-2">
            <span>üì•</span><span>Nh·∫≠p t·ª´ file JSON</span>
            <input type="file" accept=".json" hidden onchange="importChamCongJson(this.files[0])" />
          </label>
        </div>

      </div>
    </div>

    <!-- Th√¥ng tin ti√™u ƒë·ªÅ -->
    <div id="labels" class="space-y-1 text-gray-800 font-semibold">
      <p id="labelTitle" class="text-lg font-semibold"></p>
      <p id="labelDateRange" class="text-md"></p>
    </div>

    <!-- B·∫£ng d·ªØ li·ªáu ch·∫•m c√¥ng -->
    <div class="border rounded shadow overflow-auto max-h-[240px] mt-6">
      <div id="chamCongScrollWrapper" class="w-full" style="max-width:100%; width:100%;">
        <!-- table s·∫Ω render ·ªü ƒë√¢y -->
      </div>
    </div>

    <!-- B·∫£ng l·ªói -->
    <div class="border rounded shadow overflow-x-auto overflow-y-auto max-h-[240px] mt-6">
      <div id="chamCongErrorScrollWrapper" class="w-full">
        <!-- JS s·∫Ω append <table id="chamCongErrorTable"> v√†o ƒë√¢y -->
      </div>
    </div>



  </div>
</body>
<script>
  // C·∫≠p nh·∫≠t t√™n file hi·ªÉn th·ªã
  document.querySelectorAll('input[type="file"][data-file-display]').forEach(inp => {
    const target = document.querySelector(inp.getAttribute('data-file-display'))
    const update = () => {
      const f = inp.files && inp.files[0]
      target.textContent = f ? f.name : (target.dataset.placeholder || 'Ch·ªçn t·ªáp‚Ä¶')
    }
    inp.addEventListener('change', update)
    // Cho ph√©p b·∫•m v√†o label ngo√†i ƒë·ªÉ m·ªü file picker l√† m·∫∑c ƒë·ªãnh; th√™m k√©o/th·∫£ nh·∫π
    const label = inp.closest('label')
    if (label) {
      label.addEventListener('dragover', e => { e.preventDefault(); label.classList.add('ring-2', 'ring-offset-1', 'ring-blue-300') })
      label.addEventListener('dragleave', () => label.classList.remove('ring-2', 'ring-offset-1', 'ring-blue-300'))
      label.addEventListener('drop', e => {
        e.preventDefault()
        label.classList.remove('ring-2', 'ring-offset-1', 'ring-blue-300')
        if (e.dataTransfer.files?.length) {
          inp.files = e.dataTransfer.files
          inp.dispatchEvent(new Event('change', { bubbles: true }))
        }
      })
    }
  })
</script>

</html>